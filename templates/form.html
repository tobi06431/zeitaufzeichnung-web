<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Zeitaufzeichnung</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

<div class="container">
  <div class="card">

    <h2>Zeitaufzeichnung</h2>

    <!-- ✅ Flash-Messages (Erfolg / Fehler) -->
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <div class="flash-wrap">
          {% for message in messages %}
            <div class="flash">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <form method="post">

      <!-- ================= KIRCHENGEMEINDE ================= -->

      <div class="panel" data-panel-id="pfarrei">
        <div class="panel__header">
          <div class="panel__title">Pfarrei</div>
          <button type="button" class="panel__toggle" aria-expanded="true">▼</button>
        </div>
        <div class="panel__content">

          <label>Kath. Kirchengemeinde</label>
          <input
            type="text"
            name="Kath. Kirchengemeinde"
            id="kirchengemeinde_input"
            placeholder="z.B. Heilige Katharina Kaspar Limbburger Land">

          <select
            id="kirchengemeinde_select"
            onchange="setKirchengemeindeFromSelect()">
            <option value="">Vorschlag auswählen …</option>
            <option value="Heilige Katharina Kaspar Limburger Land">
              Heilige Katharina Kaspar Limburger Land
            </option>
            <option value="St. Peter und Paul Bad Camberg">
              St. Peter und Paul Bad Camberg
            </option>
            <option value="Heilig Geist Goldener Grund">
              Heilig Geist Goldener Grund
            </option>
          </select>

        </div>
      </div>

      <!-- ================= STAMMDATEN ================= -->

      <div class="panel" data-panel-id="stammdaten">
        <div class="panel__header">
          <div class="panel__title">Stammdaten</div>
          <button type="button" class="panel__toggle" aria-expanded="true">▼</button>
        </div>
        <div class="panel__content">

          <div class="grid">
            <label>Einsatzort
              <input name="Einsatzort" id="einsatzort_input" list="orte_datalist">
            </label>

            <label>GKZ
              <input name="GKZ">
            </label>
          </div>

          <datalist id="orte_datalist"></datalist>

          <label>Monat/Jahr
            <select name="Monat/Jahr" id="monatjahr_input" required></select>
          </label>

        </div>
      </div>

      <!-- ================= PERSON ================= -->

      <div class="panel" data-panel-id="person">
        <div class="panel__header">
          <div class="panel__title">Person</div>
          <button type="button" class="panel__toggle" aria-expanded="true">▼</button>
        </div>
        <div class="panel__content">

          <div class="grid">
            <label>Nachname
              <input name="Nachname" id="nachname_input">
            </label>

            <label>Vorname
              <input name="Vorname" id="vorname_input">
            </label>
          </div>

          <div class="grid">
            <label>Geburtsdatum
              <input name="Geburtsdatum" id="geburtsdatum_input">
            </label>

            <label>Pers.-Nr.
              <input name="Pers.-Nr.">
            </label>
          </div>

          <label>Tätigkeit
            <input
              name="Tätigkeit"
              id="taetigkeit_input"
              list="taetigkeit_datalist"
              placeholder="z.B. Organist">
          </label>

          <datalist id="taetigkeit_datalist">
            <option value="Organist"></option>
            <option value="Chorleiter"></option>
            <option value="Küster"></option>
          </datalist>

        </div>
      </div>

      <!-- ================= MEHRARBEIT ================= -->

      <h3>Mehrarbeit</h3>

      <div class="grid">
        <label>Beschäftigungsumfang
          <input name="Beschäftigungsumfang">
        </label>

        <label>Mehrarbeit Stunden
          <input name="Mehrarbeit Stunden">
        </label>
      </div>

      <label>Mehrarbeit (Textfeld)
        <input name="Mehrarbeit (Textfeld)">
      </label>

      <label>Datum</label>
      <div class="row">
        <input id="datum" name="Datum">
        <button type="button" class="btn btn-secondary"
          onclick="document.getElementById('datum').value='{{ today }}'">
          Heute
        </button>
      </div>

      <label>Mehrarbeitsstunden auszahlen</label>
      <select name="Mehrarbeit_auszahlen">
        <option value="Nein" selected>Nein</option>
        <option value="Ja">Ja</option>
      </select>

      <hr class="sep">

      <!-- ================= GOTTESDIENSTE ================= -->

      <div class="panel" data-panel-id="gottesdienste">
        <div class="panel__header">
          <div class="panel__title">Gottesdienste</div>
          <button type="button" class="panel__toggle" aria-expanded="true">▼</button>
        </div>
        <div class="panel__content">

          <div class="gd-box">

            <div class="grid">
              <label>Kirchort
                <input type="text" id="gd_kirchort" list="orte_datalist">
              </label>

              <label>Datum
                <input type="date" id="gd_datum">
              </label>
            </div>

            <div class="grid">
              <label>Besoldungssatz
                <input
                  type="number"
                  id="gd_satz"
                  step="0.1"
                  inputmode="decimal"
                  list="satz_datalist"
                  placeholder="z.B. 1.8">
              </label>

              <label>Dienstbeginn
                <input type="time" id="gd_beginn" step="300">
              </label>
            </div>

            <div class="grid">
              <label>Dienstende
                <input type="time" id="gd_ende" step="300">
              </label>
            </div>

            <datalist id="satz_datalist">
              <option value="1.0"></option>
              <option value="1.8"></option>
              <option value="3.6"></option>
              <option value="5.2"></option>
            </datalist>

            <div class="row" style="margin-top: 10px;">
              <button type="button" class="btn btn-secondary" onclick="addGottesdienst()">
                Gottesdienst hinzufügen
              </button>
              <button type="button" class="btn btn-danger" onclick="clearGottesdienste()">
                Liste leeren
              </button>
            </div>

            <p class="section-hint">
              Gottesdienste werden lokal im Browser gespeichert – getrennt nach Pfarrei und Monat/Jahr.
            </p>
          </div>

        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th>Kirchort</th>
            <th>Datum</th>
            <th>Satz</th>
            <th>Beginn</th>
            <th>Ende</th>
            <th>Aktion</th>
          </tr>
        </thead>
        <tbody id="gd_liste"></tbody>
      </table>

      <input type="hidden" name="Gottesdienste" id="gottesdienste_json">

      <div class="actions actions-bottom">
  <button
    type="submit"
    class="btn btn-secondary"
    formnovalidate
  >
    PDF erzeugen
  </button>

  <button
    type="submit"
    name="action"
    value="send_mail"
    class="btn btn-primary"
    formnovalidate
  >
    Daten an Verwaltung senden
  </button>
</div>


    </form>

  </div>
</div>

<script src="{{ url_for('static', filename='app.js') }}"></script>

</body>
</html>
