<!DOCTYPE html><html lang="de"><head>  <meta charset="UTF-8">  <title>Zeitaufzeichnung</title>  <meta name="viewport" content="width=device-width, initial-scale=1">  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"></head><body><h2>Zeitaufzeichnung</h2><form method="post">  <!-- ================= KIRCHENGEMEINDE ================= -->  <label>Kath. Kirchengemeinde</label>  <input    type="text"    name="Kath. Kirchengemeinde"    id="kirchengemeinde_input"    placeholder="z.B. Heilige Katharina Kaspar Limburger Land">  <select    id="kirchengemeinde_select"    onchange="setKirchengemeindeFromSelect()">    <option value="">Vorschlag auswählen …</option>    <option value="Heilige Katharina Kaspar Limburger Land">      Heilige Katharina Kaspar Limburger Land    </option>    <option value="St. Peter und Paul Bad Camberg">      St. Peter und Paul Bad Camberg    </option>    <option value="Heilig Geist Goldener Grund">      Heilig Geist Goldener Grund    </option>  </select>  <!-- ================= STAMMDATEN ================= -->  <label>Einsatzort    <input name="Einsatzort" id="einsatzort_input" list="orte_datalist">  </label>  <datalist id="orte_datalist"></datalist>  <label>GKZ    <input name="GKZ">  </label>  <label>Monat/Jahr    <input name="Monat/Jahr" id="monatjahr_input" placeholder="z.B. 12/2025">  </label>  <label>Nachname    <input name="Nachname">  </label>  <label>Vorname    <input name="Vorname">  </label>  <label>Geburtsdatum    <input name="Geburtsdatum">  </label>  <label>Pers.-Nr.    <input name="Pers.-Nr.">  </label>  <label>Tätigkeit    <input name="Tätigkeit">  </label>  <label>Beschäftigungsumfang    <input name="Beschäftigungsumfang">  </label>  <label>Mehrarbeit (Textfeld)    <input name="Mehrarbeit (Textfeld)">  </label>  <label>Mehrarbeit Stunden    <input name="Mehrarbeit Stunden">  </label>  <label>Datum</label>  <div class="row">    <input id="datum" name="Datum">    <button type="button"      onclick="document.getElementById('datum').value='{{ today }}'">      Heute    </button>  </div>  <label>Mehrarbeitsstunden auszahlen</label>  <select name="Mehrarbeit_auszahlen">    <option value="Nein" selected>Nein</option>    <option value="Ja">Ja</option>  </select>  <!-- ================= GOTTESDIENSTE ================= -->  <h3>Gottesdienste</h3>  <div class="gd-box">    <label>Kirchort      <input type="text" id="gd_kirchort" list="orte_datalist">    </label>    <label>Datum      <input type="date" id="gd_datum">    </label>    <label>Besoldungssatz      <input        type="number"        id="gd_satz"        step="0.1"        inputmode="decimal"        list="satz_datalist"        placeholder="z.B. 1.8">    </label>    <datalist id="satz_datalist">      <option value="1.0"></option>      <option value="1.8"></option>      <option value="3.6"></option>      <option value="5.2"></option>    </datalist>    <label>Dienstbeginn      <input type="time" id="gd_beginn" step="300">    </label>    <label>Dienstende      <input type="time" id="gd_ende" step="300">    </label>    <div class="row">      <button type="button" onclick="addGottesdienst()">        Gottesdienst hinzufügen      </button>      <button type="button" onclick="clearGottesdienste()">        Liste leeren      </button>    </div>    <p style="margin:0.5rem 0 0; font-size: 0.95rem;">      Hinweis: Gottesdienste werden lokal im Browser gespeichert – getrennt nach Pfarrei und Monat/Jahr.    </p>  </div>  <table>    <thead>      <tr>        <th>Kirchort</th>        <th>Datum</th>        <th>Satz</th>        <th>Beginn</th>        <th>Ende</th>        <th>Aktion</th>      </tr>    </thead>    <tbody id="gd_liste"></tbody>  </table>  <input type="hidden" name="Gottesdienste" id="gottesdienste_json">  <div class="actions">    <button type="submit" formnovalidate>PDF erzeugen</button>  </div></form><script>/* ================= ORTSVORSCHLÄGE pro Pfarrei ================= */const ORTE_HKK = [  "St. Georg Dom",  "St. Antonius Eschhofen",  "St. Hildegard Limburg",  "St. Jakobus Lindenholzhausen",  "St. Johannes d.T. Elz",  "St. Josef Staffel",  "St. Lubentius Dietkirchen",  "St. Marien Limburg",  "St. Nikolaus Dehrn",  "St. Servatius Offheim"];function getSelectedPfarrei() {  return (document.getElementById("kirchengemeinde_input").value || "").trim();}function setOrteDatalist(options) {  const dl = document.getElementById("orte_datalist");  dl.innerHTML = "";  (options || []).forEach(o => {    const opt = document.createElement("option");    opt.value = o;    dl.appendChild(opt);  });}function updateOrtSuggestions() {  if (getSelectedPfarrei() === "Heilige Katharina Kaspar Limburger Land") {    setOrteDatalist(ORTE_HKK);  } else {    setOrteDatalist([]);  }}function setKirchengemeindeFromSelect() {  const sel = document.getElementById("kirchengemeinde_select");  if (sel.value) {    document.getElementById("kirchengemeinde_input").value = sel.value;  }  updateOrtSuggestions();  handleContextChange(); // <<< wichtig: beim Wechsel automatisch umschalten}document.getElementById("kirchengemeinde_input").addEventListener("input", () => {  updateOrtSuggestions();  handleContextChange();});updateOrtSuggestions();/* ================= 5-MINUTEN-ERZWINGUNG ================= */function roundTimeTo5Minutes(t) {  if (!t) return "";  let [h, m] = t.split(":").map(Number);  if (Number.isNaN(h) || Number.isNaN(m)) return t;  m = Math.round(m / 5) * 5;  if (m === 60) { h = (h + 1) % 24; m = 0; }  return String(h).padStart(2, "0") + ":" + String(m).padStart(2, "0");}function enforce5MinuteStep(el) {  if (!el) return;  const r = roundTimeTo5Minutes(el.value);  if (r && r !== el.value) el.value = r;}["gd_beginn", "gd_ende"].forEach(id => {  const el = document.getElementById(id);  if (!el) return;  el.addEventListener("change", () => enforce5MinuteStep(el));  el.addEventListener("blur", () => enforce5MinuteStep(el));});/* ================= Browser-Speicher: getrennt nach Pfarrei + Monat ================= */let gottesdienste = [];// merkt sich, welcher Kontext gerade aktiv ist (damit wir beim Wechsel speichern/laden)let currentStorageKey = "";function normalizeKeyPart(s) {  return (s || "")    .trim()    .replace(/\s+/g, " ")    .replace(/[|]/g, ""); // trenner entfernen}function getStorageKey() {  const pfarrei = normalizeKeyPart(document.getElementById("kirchengemeinde_input").value);  const monat = normalizeKeyPart(document.getElementById("monatjahr_input").value);  // Falls noch nichts eingetragen: trotzdem stabiler Key  const p = pfarrei || "UNBEKANNT_PFARREI";  const m = monat || "OHNE_MONAT";  return `za_gd_v2|${p}|${m}`;}function saveGottesdiensteToStorage() {  if (!currentStorageKey) currentStorageKey = getStorageKey();  localStorage.setItem(currentStorageKey, JSON.stringify(gottesdienste));}function loadGottesdiensteFromStorage(key) {  try {    const raw = localStorage.getItem(key);    const arr = raw ? JSON.parse(raw) : [];    return Array.isArray(arr) ? arr : [];  } catch (e) {    return [];  }}function handleContextChange() {  const newKey = getStorageKey();  // wenn sich nichts geändert hat: nichts tun  if (newKey === currentStorageKey) return;  // alten Kontext speichern (aber nur, wenn es schon einen gab)  if (currentStorageKey) {    localStorage.setItem(currentStorageKey, JSON.stringify(gottesdienste));  }  // neuen Kontext laden  currentStorageKey = newKey;  gottesdienste = loadGottesdiensteFromStorage(currentStorageKey);  updateListe();}document.getElementById("monatjahr_input").addEventListener("input", handleContextChange);/* ================= Gottesdienste CRUD ================= */function addGottesdienst() {  enforce5MinuteStep(document.getElementById("gd_beginn"));  enforce5MinuteStep(document.getElementById("gd_ende"));  const kirchort = document.getElementById("gd_kirchort").value.trim();  const datum = document.getElementById("gd_datum").value;  const satz = document.getElementById("gd_satz").value;  const beginn = document.getElementById("gd_beginn").value;  const ende = document.getElementById("gd_ende").value;  if (!kirchort || !datum || !satz || !beginn || !ende) {    alert("Bitte alle Felder ausfüllen.");    return;  }  gottesdienste.push({ kirchort, datum, satz, beginn, ende });  document.getElementById("gd_kirchort").value = "";  document.getElementById("gd_datum").value = "";  document.getElementById("gd_satz").value = "";  document.getElementById("gd_beginn").value = "";  document.getElementById("gd_ende").value = "";  updateListe();  saveGottesdiensteToStorage();}function removeGottesdienst(i) {  gottesdienste.splice(i, 1);  updateListe();  saveGottesdiensteToStorage();}function clearGottesdienste() {  if (!confirm("Willst du wirklich alle Gottesdienste dieser Aufzeichnung löschen?")) return;  gottesdienste = [];  updateListe();  if (currentStorageKey) localStorage.removeItem(currentStorageKey);}function updateListe() {  const tbody = document.getElementById("gd_liste");  tbody.innerHTML = "";  gottesdienste.forEach((gd, i) => {    const row = document.createElement("tr");    row.innerHTML = `      <td>${gd.kirchort}</td>      <td>${gd.datum}</td>      <td>${gd.satz}</td>      <td>${gd.beginn}</td>      <td>${gd.ende}</td>      <td>        <button type="button" onclick="removeGottesdienst(${i})">X</button>      </td>    `;    tbody.appendChild(row);  });  document.getElementById("gottesdienste_json").value =    JSON.stringify(gottesdienste);}/* Beim Laden: passenden Kontext initial laden */window.addEventListener("DOMContentLoaded", () => {  currentStorageKey = getStorageKey();  gottesdienste = loadGottesdiensteFromStorage(currentStorageKey);  updateListe();});/* Submit: JSON sicher setzen */document.querySelector("form").addEventListener("submit", () => {  document.getElementById("gottesdienste_json").value =    JSON.stringify(gottesdienste);});</script></body></html>